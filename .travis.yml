language: ruby

rvm:
  - 2.2.0

env:
  global:
    - "HOST_IP=$(/sbin/ifconfig venet0:0 | grep 'inet addr' | awk -F: '{print $2}' | awk '{print $1}')"
    - DOCKER_HOST=tcp://$HOST_IP:2375

install:
  - sudo sh -c "wget -qO- https://get.docker.io/gpg | apt-key add -"
  - sudo sh -c "echo deb http://get.docker.io/ubuntu docker main > /etc/apt/sources.list.d/docker.list"
  - sudo apt-get update
  - sudo mkdir -p /var/lib/docker
  - echo exit 101 | sudo tee /usr/sbin/policy-rc.d
  - sudo chmod +x /usr/sbin/policy-rc.d
  - sudo apt-get install -y slirp lxc lxc-docker-1.4.1 aufs-tools cgroup-lite curl
  - curl -sLo linux https://github.com/jpetazzo/sekexe/raw/master/uml
  - chmod +x linux

before_script:
  - "./linux mem=2G rootfstype=hostfs rw eth0=slirp,,/usr/bin/slirp-fullbolt init=$(pwd)/.travis.d/docker.sh WORKDIR=$(pwd) HOME=$(pwd) PATH=$PATH &"
  - "while ! docker info ; do sleep 2; done"

script:
  - "docker run -ti --publish 8000:8000 --volume $(pwd):/app_data --workdir /app_data centos python -m SimpleHTTPServer 8000"
  - "curl -L $(HOST_IP):8000"
